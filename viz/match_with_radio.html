<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Les mots de l'accueil</title>
    
    <!-- Css Lib -->
    <link href="./lib/css/bootstrap.min.css" rel="stylesheet">
    <link href="./lib/css/font-awesome.min.css" rel="stylesheet"> 
    <link href="./lib/css/qlobbe.css" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"> 
    
    <!-- Javascript Lib -->
    <script type="text/javascript" src="./lib/js/jquery-1.12.1.min.js"></script>
    <script type="text/javascript" src="./lib/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./lib/js/d3.min.js"></script> 
    <script type="text/javascript" src="./lib/js/underscore-min.js"></script>  

    <style>

    .info-graph {
      width: 300px;
    }

    .info-txt {
       left: 320px;
       width: 740px;
    }

    .info-box {
      font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
      text-decoration: none;
      letter-spacing: 1px;
      font-size: 12px; 
    }

    .info-box-btn {
      font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
      text-decoration: none;
      letter-spacing: 1px;
      font-size: 12px;
      padding-left: 0px; 
      padding-top: 5px;
    }   

    .graph-box {
      font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
      text-decoration: none;
      letter-spacing: 1px;
      font-size: 12px;
    }      

    .btn {
        text-align: start;
        cursor: pointer; 
        width:180px;
        padding-top: 10px;      
    }  

    .inter-name {
        font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
        letter-spacing: 1px;
        font-size: 16px;
        line-height: 16px;
        font-weight: 900; 
        color: #000;       
    }

    .nop {
      color: #B3B8B2;
    }

    div.tooltip {  
      position: absolute;     
      text-align: start;     
      width: 300px;         
      padding: 2px;       
      font: 12px sans-serif;    
      background: #FFF; 
      border: 1px;
      border-color: #000;
      border-style: solid;    
      pointer-events: none;     
    }

    .head, .info, .data {
      margin-top:   30px;
      margin-left:  30px;
      margin-right: 30px;
    }

    .title {
      font-family: 'Montserrat', sans-serif;
      text-rendering: optimizeLegibility;
      font-size: 30px;
      font-weight: 700;   
      color: #202626;
      margin-bottom:10px;
      margin-left: 50px;
    }

    .subtitle {
      font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
      font-size: 16px;
      color: #2C3E50;
    } 

    .dateHeader {
      font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
      letter-spacing: 1px;
      font-size: 16px;
      line-height: 16px;
      font-weight: 900;   
      color: #2C3E50;
    }

    .inter-header {
      font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
      letter-spacing: 1px;
      font-size: 16px;
      line-height: 16px;
      font-weight: 900;   
      color: #000;
      cursor: pointer; 
    } 

    .inter-top {
      font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
      letter-spacing: 1px;
      font-size: 16px;
      line-height: 16px;
      font-weight: 900;   
      color: #000; 
    }              

    .red {
      color: #B23C2C;
    }

    .blue {
      color: #3284FE; 
    }

    .axis--x {
      display: none;
    }

    .bq-inter {
      font-family: "Egyptienne";
      font-size: 13px;
    }

    body {
      background-color: #FFF;
    }

    .link {
      fill: none;
      stroke: #3284FE;
      stroke-width: 2px;
      opacity : 0.5;
    }
  

    </style>    

  </head>
  <body>
    
    <!-- Container for the viz -->
    <div class="container-fluid head">
      <p class="title">J'en ai entendu parler sur France Inter</p>
    </div>
    <br>
    <div class="info">
      <div class="row">
        <div class="col-md-3 info-graph" id="graph-info"></div>
        <div class="col-md-9 info-txt">
          <div class="info-box">
            <p>
              En <b>septembre 2015</b>, les médias de tous les pays et les réseaux sociaux regorgeaient de reportages sur les réfugiés, en souffrance, aux portes de l’Europe. Conjointement à cette séquence médiatique, l'association Singa a bénéficié de 3 reportages successifs sur les ondes de <b>France Inter</b>, décrivant à un large public les conditions de l'accueil d'un réfugié chez-soi. Les lettres d'accueillants mentionnent explicitement France Inter comme vecteur de découverte de <b>Singa</b> en complément d'internet seul. Dans quelle mesure le vocabulaire utilisé lors des différents reportages a-t-il pu encourager les nouveaux participants et les influencer jusque dans la rédaction même de leurs lettres de motivation ?
            </p>            
          </div>          
          <br>

          <div>
            <div class="btn-group" data-toggle="buttons">
              <label class="btn btn-secondary active inter" id="inter_1">
                <input type="radio" name="options" id="option1" autocomplete="off" checked> 
                <p class="inter-name">Reportage n°1</p>
                <div class="info-box-btn">
                  <p><i class="fa fa-calendar" aria-hidden="true" style="color:#B23C2C"></i> 03 Sept 2015 - 2 mn</p>
                  <p><a href=""><i class="fa fa-headphones" aria-hidden="true" style="color:#B23C2C"></i></a> <i>Soyez solidaires,<br>accueillez un réfugié<br>chez vous.</i></p>
                </div>
              </label>
              <label class="btn btn-secondary inter" id="inter_2">
                <input type="radio" name="options" id="option2" autocomplete="off">
                <p class="inter-name">Reportage n°2</p>
                <div class="info-box-btn">
                  <p><i class="fa fa-calendar" aria-hidden="true" style="color:#B23C2C"></i> 15 Sept 2015 - 4 mn</p>
                  <p><a href=""><i class="fa fa-headphones" aria-hidden="true" style="color:#B23C2C"></i></a> <i>La communauté 2.0<br>pour les réfugiés.</i></p>
                </div>                
              </label>
              <label class="btn btn-secondary inter" id="inter_3">
                <input type="radio" name="options" id="option3" autocomplete="off">
                <p class="inter-name">Reportage n°3</p>
                <div class="info-box-btn">
                  <p><i class="fa fa-calendar" aria-hidden="true" style="color:#B23C2C"></i> 15 Sept 2015 - 40 mn</p>
                  <p><a href=""><i class="fa fa-headphones" aria-hidden="true" style="color:#B23C2C"></i></a> <i>Accueillir les réfugiés<br>chez soi: vraie ou fausse<br>bonne idée ?</i></p>                  
                </div>                
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid data" id="viz">

    </div>
    </div>
       
  </body>

  <script type="text/javascript">

  function removeDiacritics (str) {
      var diacriticsMap = {
          A: /[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g,
          AA: /[\uA732]/g,
          AE: /[\u00C6\u01FC\u01E2]/g,
          AO: /[\uA734]/g,
          AU: /[\uA736]/g,
          AV: /[\uA738\uA73A]/g,
          AY: /[\uA73C]/g,
          B: /[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g,
          C: /[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g,
          D: /[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g,
          DZ: /[\u01F1\u01C4]/g,
          Dz: /[\u01F2\u01C5]/g,
          E: /[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g,
          F: /[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g,
          G: /[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g,
          H: /[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g,
          I: /[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g,
          J: /[\u004A\u24BF\uFF2A\u0134\u0248]/g,
          K: /[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g,
          L: /[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g,
          LJ: /[\u01C7]/g,
          Lj: /[\u01C8]/g,
          M: /[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g,
          N: /[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g,
          NJ: /[\u01CA]/g,
          Nj: /[\u01CB]/g,
          O: /[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g,
          OI: /[\u01A2]/g,
          OO: /[\uA74E]/g,
          OU: /[\u0222]/g,
          P: /[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g,
          Q: /[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g,
          R: /[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g,
          S: /[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g,
          T: /[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g,
          TZ: /[\uA728]/g,
          U: /[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g,
          V: /[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g,
          VY: /[\uA760]/g,
          W: /[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g,
          X: /[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g,
          Y: /[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g,
          Z: /[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g,
          a: /[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g,
          aa: /[\uA733]/g,
          ae: /[\u00E6\u01FD\u01E3]/g,
          ao: /[\uA735]/g,
          au: /[\uA737]/g,
          av: /[\uA739\uA73B]/g,
          ay: /[\uA73D]/g,
          b: /[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g,
          c: /[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g,
          d: /[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g,
          dz: /[\u01F3\u01C6]/g,
          e: /[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g,
          f: /[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g,
          g: /[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g,
          h: /[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g,
          hv: /[\u0195]/g,
          i: /[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g,
          j: /[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g,
          k: /[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g,
          l: /[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g,
          lj: /[\u01C9]/g,
          m: /[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g,
          n: /[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g,
          nj: /[\u01CC]/g,
          o: /[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g,
          oi: /[\u01A3]/g,
          ou: /[\u0223]/g,
          oo: /[\uA74F]/g,
          p: /[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g,
          q: /[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g,
          r: /[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g,
          s: /[\u0073\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g,
          ss: /[\u00DF]/g,
          t: /[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g,
          tz: /[\uA729]/g,
          u: /[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g,
          v: /[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g,
          vy: /[\uA761]/g,
          w: /[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g,
          x: /[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g,
          y: /[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g,
          z: /[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g
      };
      for (var x in diacriticsMap) {
          // Iterate through each keys in the above object and perform a replace
          str = str.replace(diacriticsMap[x], x);
      }
      return str;
  }  

    var interUrl = ["https://www.franceinter.fr/emissions/grand-angle/grand-angle-03-septembre-2015","https://www.franceinter.fr/emissions/l-esprit-d-initiative/l-esprit-d-initiative-15-septembre-2015","https://www.franceinter.fr/emissions/un-jour-en-france/un-jour-en-france-15-septembre-2015"]

    var m = {t: 5, r: 0, b: 5, l: 140},
        w = 535 - m.r,
        h = 290 - m.t - m.b;

    var svg = d3.select("#graph-info").append("svg")
        .attr("width" , w)
        .attr("height", h);           

    // Spark Lines

    var docs = [['2015-09-01',26],['2015-09-02',41],['2015-09-03',414],['2015-09-04',972],['2015-09-05',1059],['2015-09-06',965],['2015-09-07',998],['2015-09-08',599],['2015-09-09',427],['2015-09-10',426],['2015-09-11',344],['2015-09-12',289],['2015-09-13',219],['2015-09-14',191],['2015-09-15',187],['2015-09-16',117],['2015-09-17',133],['2015-09-18',95],['2015-09-19',59],['2015-09-20',51],['2015-09-21',62],['2015-09-22',60],['2015-09-23',69],['2015-09-24',65],['2015-09-25',41],['2015-09-26',38],['2015-09-27',26],['2015-09-28',39],['2015-09-29',29],['2015-09-30',40]]

    var tokens = [
      {
        id:"radio",
        values :[{'date': '2015-09-01', 'freq': 0.0}, {'date': '2015-09-02', 'freq': 0.0}, {'date': '2015-09-03', 'freq': 3.4154589371980677}, {'date': '2015-09-04', 'freq': 3.380658436213992}, {'date': '2015-09-05', 'freq': 2.0387157695939566}, {'date': '2015-09-06', 'freq': 0.7253886010362695}, {'date': '2015-09-07', 'freq': 2.004008016032064}, {'date': '2015-09-08', 'freq': 1.8363939899833055}, {'date': '2015-09-09', 'freq': 1.639344262295082}, {'date': '2015-09-10', 'freq': 1.8779342723004695}, {'date': '2015-09-11', 'freq': 1.4534883720930232}, {'date': '2015-09-12', 'freq': 1.3840830449826989}, {'date': '2015-09-13', 'freq': 1.82648401826484}, {'date': '2015-09-14', 'freq': 1.5706806282722514}, {'date': '2015-09-15', 'freq': 4.7695187165775402}, {'date': '2015-09-16', 'freq': 4.7094017094017093}, {'date': '2015-09-17', 'freq': 4.0118796992481203}, {'date': '2015-09-18', 'freq': 2.0526315789473684}, {'date': '2015-09-19', 'freq': 0.0}, {'date': '2015-09-20', 'freq': 1.9607843137254901}, {'date': '2015-09-21', 'freq': 1.6129032258064515}, {'date': '2015-09-22', 'freq': 0.0}, {'date': '2015-09-23', 'freq': 0.0}, {'date': '2015-09-24', 'freq': 0.0}, {'date': '2015-09-25', 'freq': 0.0}, {'date': '2015-09-26', 'freq': 0.0}, {'date': '2015-09-27', 'freq': 0.0}, {'date': '2015-09-28', 'freq': 0.0}, {'date': '2015-09-29', 'freq': 0.0}, {'date': '2015-09-30', 'freq': 0.0}]
      },
      {
        id:"internet",
        values :[{'date': '2015-09-01', 'freq': 3.8461538461538463}, {'date': '2015-09-02', 'freq': 2.4390243902439024}, {'date': '2015-09-03', 'freq': 4.830917874396135}, {'date': '2015-09-04', 'freq': 5.349794238683128}, {'date': '2015-09-05', 'freq': 7.459867799811143}, {'date': '2015-09-06', 'freq': 6.424870466321243}, {'date': '2015-09-07', 'freq': 6.713426853707415}, {'date': '2015-09-08', 'freq': 6.510851419031719}, {'date': '2015-09-09', 'freq': 7.7283372365339575}, {'date': '2015-09-10', 'freq': 6.103286384976526}, {'date': '2015-09-11', 'freq': 8.174418604651162}, {'date': '2015-09-12', 'freq': 7.996539792387543}, {'date': '2015-09-13', 'freq': 5.30593607305936}, {'date': '2015-09-14', 'freq': 3.424083769633508}, {'date': '2015-09-15', 'freq': 4.02139037433155}, {'date': '2015-09-16', 'freq': 3.6923076923076925}, {'date': '2015-09-17', 'freq': 3.774436090225564}, {'date': '2015-09-18', 'freq': 3.2631578947368425}, {'date': '2015-09-19', 'freq': 3.084745762711864}, {'date': '2015-09-20', 'freq': 3.72549019607843}, {'date': '2015-09-21', 'freq': 3.064516129032258}, {'date': '2015-09-22', 'freq': 3.333333333333334}, {'date': '2015-09-23', 'freq': 3.797101449275362}, {'date': '2015-09-24', 'freq': 2.615384615384615}, {'date': '2015-09-25', 'freq': 0.0}, {'date': '2015-09-26', 'freq': 0.0}, {'date': '2015-09-27', 'freq': 0.0}, {'date': '2015-09-28', 'freq': 0.0}, {'date': '2015-09-29', 'freq': 0.0}, {'date': '2015-09-30', 'freq': 0.0}]
      }
    ]

    var parseTime = d3.timeParse("%Y-%m-%d");

    _.each(tokens,function(token){
      _.each(token.values,function(d){
        return d.date = parseTime(d.date)
      })
    })

    var xScale  = d3.scaleTime().range([0, 200]);
    var yScale  = d3.scaleLinear().range([80,0]);
    var y2Scale = d3.scaleLinear().range([80,0]);

    var line = d3.line()
        .curve(d3.curveBasis)
        .x(function(d) { return xScale(d.date); })
        .y(function(d) { return yScale(d.freq); });    
    
    xScale.domain([parseTime("2015-09-01"),parseTime("2015-09-30")]);
    yScale.domain([0,10]);
    y2Scale.domain([0,1100]);

    g = svg.append("g").attr("transform", "translate(" + ( m.l + 40 )  + "," + 0 + ")"); 

    g.append("g")
      .attr("transform", "translate(0," + 300 + ")")
      .attr("class","axis--x")
      .call(d3.axisBottom(xScale));  

    var timeSeries = g.selectAll(".timeSeries")
        .data(tokens)
        .enter().append("g")
        .attr("class", "timeSeries");

    timeSeries.selectAll("bar")
      .data(docs)
      .enter().append("rect")
      .style("fill", "#000")
      .attr("x", function(d) { return xScale(parseTime(d[0])) - 1.5; })
      .attr("width", 2)
      .attr("y", function(d) { return y2Scale(d[1]) + 10; })
      .attr("height", function(d) { return 80 - y2Scale(d[1]); });

    timeSeries.append("path")
      .attr("transform", "translate(" + 0  + "," + 100 + ")")
      .attr("class", "line")
      .attr("d", function(d) { return line(d.values); })
      .style("stroke","#000")
      .style("fill","none");

    timeSeries.append("text")
      .datum(function(d) { return {id: d.id, value: d.values[0]}; })
      .attr("transform", function(d) { return "translate(" + xScale(d.value.date) + "," + (yScale(d.value.freq) + 100) + ")"; })
      .attr("x", -20)
      .attr("dy", "0.15em")
      .attr("text-anchor", "end")       
      .style("font", "10px sans-serif")
      .text(function(d) { return d.id + " (%)"; });        

    timeSeries.append("line")
      .attr("x1",xScale(parseTime("2015-09-03")))
      .attr("y1",5)
      .attr("x2",xScale(parseTime("2015-09-03")))
      .attr("y2",195)
      .attr("stroke-width", 0.5)
      .style("stroke-dasharray", ("3, 3"))
      .attr("stroke", "red"); 

    timeSeries.append("text")
      .attr("x",xScale(parseTime("2015-09-03")))
      .attr("y",105)
      .attr("transform", "translate(" + 10  + "," + 100 + ")")
      .attr("text-anchor", "middle")      
      .style("font", "10px sans-serif")   
      .style("font-weight","300")         
      .text("03 Sept 15")

    timeSeries.append("line")
      .attr("x1",xScale(parseTime("2015-09-15")))
      .attr("y1",5)
      .attr("x2",xScale(parseTime("2015-09-15")))
      .attr("y2",195)
      .attr("stroke-width", 0.5)
      .style("stroke-dasharray", ("3, 3"))
      .attr("stroke", "red");   

    timeSeries.append("text")
      .attr("x",xScale(parseTime("2015-09-15")))
      .attr("y",105)
      .attr("transform", "translate(" + 10  + "," + 100 + ")")
      .attr("text-anchor", "middle")
      .style("font", "10px sans-serif")   
      .style("font-weight","300")         
      .text("15 Sept 15")

    timeSeries.append("text")
      .attr("x",-5)
      .attr("y",135)
      .attr("transform", "translate(" + 0  + "," + 100 + ")")
      .attr("text-anchor", "start")
      .style("font", "12px sans-serif")   
      .style("font-weight","300")         
      .text("Entre le 03 et le 15 Septembre 2015, Calm a reçu plus de");

    timeSeries.append("text")
      .attr("x",-5)
      .attr("y",150)
      .attr("transform", "translate(" + 0  + "," + 100 + ")")
      .attr("text-anchor", "start")
      .style("font", "12px sans-serif")   
      .style("font-weight","300")         
      .text("7000 inscriptions d'accueillants. Un nombre significatif")

    timeSeries.append("text")
      .attr("x",-5)
      .attr("y",165)
      .attr("transform", "translate(" + 0  + "," + 100 + ")")
      .attr("text-anchor", "start")
      .style("font", "12px sans-serif")   
      .style("font-weight","300")                 
      .text("d'entre eux en a, à chaque fois, entendu parler à la radio.")

    timeSeries.append("text")
      .attr("transform", "translate(" + -5  + "," + 50 + ")")
      .attr("x", -20)
      .attr("dy", "0.15em")
      .attr("text-anchor", "end")       
      .style("font", "10px sans-serif")
      .style("font-weight","300")
      .text("inscriptions"); 

    timeSeries.append("circle")
      .attr("transform", "translate(" + 0  + "," + 100 + ")")
      .attr("cx",xScale(parseTime("2015-09-11")) + 3)
      .attr("cy",yScale(8.174418604651162))
      .attr("r",3)
      .attr("fill","#3284FE")          
   
    timeSeries.append("text")
      .attr("x",xScale(parseTime("2015-09-11")) + 3)
      .attr("y",yScale(8.174418604651162) - 5)
      .attr("transform", "translate(" + 0  + "," + 100 + ")")
      .attr("text-anchor", "middle")
      .style("font", "10px sans-serif")   
      .style("font-weight","300")         
      .text("8.2 %")

    timeSeries.append("text")
      .attr("x",xScale(parseTime("2015-09-15")) + 20)
      .attr("y",yScale(4.7695187165775402) - 5)
      .attr("transform", "translate(" + 0  + "," + 100 + ")")
      .attr("text-anchor", "middle")
      .style("font", "10px sans-serif")   
      .style("font-weight","300")         
      .text("4.7 %")       

    timeSeries.append("circle")
      .attr("transform", "translate(" + 0  + "," + 100 + ")")
      .attr("cx",xScale(parseTime("2015-09-15")) + 5)
      .attr("cy",yScale(4.7695187165775402))
      .attr("r",3)
      .attr("fill","#3284FE") 

    timeSeries.append("circle")
      .attr("cx",xScale(parseTime("2015-09-05")) - 1)
      .attr("cy",y2Scale(1059) + 10)
      .attr("r",3)
      .attr("fill","#3284FE")      

    timeSeries.append("text")
      .attr("x",xScale(parseTime("2015-09-05")))
      .attr("y",y2Scale(1059) + 5)
      .attr("text-anchor", "middle")
      .style("font", "10px sans-serif")   
      .style("font-weight","300")         
      .text("1059") 

    /*
     * Data viz
     */ 

    var months = ["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]

    var top_inter = [[['france', 130],['association', 69],['aide', 51],['accueillez', 50],['quelques', 35],['personnes', 33],['faire', 27],['site', 25],['avoir', 23],['propose', 21],['trouver', 21],['cherche', 20],['si', 20],['singa', 19],['gens', 19],['internet', 17],['être', 15],['semaines', 14],['chez', 13],['familles', 13]],[['france', 130],['parle', 111],['inter', 110],['association', 69],['accueil', 50],['quelques', 35],['matin', 33],['personnes', 33],['faire', 27],['avoir', 23],['proposer', 21],['trouver', 21],['si', 20],['fait', 19],['singa', 19],['gens', 19],['peut', 17],['tout', 15],['être', 15],['situation', 14]],[['france', 130],['parlé', 111],['association', 69],['accueillir', 50],['quelqu', 35],['personnes', 33],['depuis', 24],['avoir', 23],['proposer', 21],['singa', 19],['gens', 19],['fait', 19],['pense', 17],['peut', 17],['internet', 17],['tout', 15],['être', 15],['via', 14],['situation', 14],['famille', 13]]]

    var lineGenerator = d3.line().curve(d3.curveBasis);

    var m2 = {t: 10, r: 10, b: 10, l: 10},
        w2 = 1800 - m2.l - m2.r,
        h2 = 1000 - m2.t - m2.b;

    var svg2 = d3.select("#viz").append("svg")
        .attr("width" , w2)
        .attr("height", h2); 

    g2 = svg2.append("g").attr("transform", "translate(" + m2.l  + "," + m2.t + ")");  

    var txt = g2.append("g")
        .attr("class", "txt");

    var txtX = 150

    var inter_ = {}; 

    svg2.append("text")
      .attr("class","inter-header")
      .attr("x", txtX + 10)
      .attr("y", 20)
      .attr("text-anchor", "start")
      .text("Reportage n°1")
      .on("click", function() { window.open(interUrl[0]); });

    svg2.append("text")
      .attr("class","inter-top")
      .attr("x", txtX - 10)
      .attr("y", 20)
      .attr("text-anchor", "end")
      .text("Top");

    _.each(top_inter[0],function(top){
      svg2.append("text")
        .attr("class","yo")
        .attr("x", txtX - 10)
        .attr("y", 40 + 12 * top_inter[0].indexOf(top))
        .attr("text-anchor", "end")
        .style("font", "10px sans-serif")
        .text(top[0] + " [" + top[1] + "]");
    })     

    d3.json("./france_inter_match.json", function(data) {
      // init

      inter_ = data;

      txt.append("text")
         .attr("class","yo")
         .attr("x", txtX)
         .attr("y", 30)
         .attr("text-anchor", "start")       
         .style("font", "10px sans-serif")
         .attr("dy", "0.15em")
         .text(inter_["inter_1"].full); 

      txt.selectAll("text")
         .call(wrap, 350, inter_["inter_1"].token);

    })

    function interClick(idx) {
      svg2.selectAll(".yo").remove()
      svg2.selectAll(".inter-header").remove() 
      svg2.selectAll(".inter-top").remove() 
      svg2.selectAll(".link").remove()  
      svg2.selectAll(".letters").attr("fill","#B3B8B2")

      svg2.append("text")
        .attr("class","inter-header")
        .attr("x", txtX + 10)
        .attr("y", 20)
        .attr("text-anchor", "start")
        .text("Reportage n°" + idx)
        .on("click", function() { window.open(interUrl[idx - 1]); });

      txt.append("text")
         .attr("class","yo")
         .attr("x", txtX)
         .attr("y", 30)
         .attr("text-anchor", "start")       
         .style("font", "10px sans-serif")
         .attr("dy", "0.15em")
         .text(inter_["inter_" + idx].full); 

      txt.selectAll("text")
         .call(wrap, 350, inter_["inter_" + idx].token); 

      svg2.append("text")
        .attr("class","inter-top")
        .attr("x", txtX - 10)
        .attr("y", 20)
        .attr("text-anchor", "end")
        .text("Top");

      _.each(top_inter[idx - 1],function(top){
        svg2.append("text")
          .attr("class","yo")
          .attr("x", txtX - 10)
          .attr("y", 40 + 12 * top_inter[idx - 1].indexOf(top))
          .attr("text-anchor", "end")
          .style("font", "10px sans-serif")
          .text(top[0] + " [" + top[1] + "]");
      })              
    }

    d3.select("#inter_1").on("click", function(){ interClick(1) })  
    d3.select("#inter_2").on("click", function(){ interClick(2) })  
    d3.select("#inter_3").on("click", function(){ interClick(3) })            

    // Letters part

    var div = d3.select("body").append("div") 
       .attr("class", "tooltip")       
       .style("opacity", 0);

    var docs  = g2.append("g")
       .attr("class", "docs");

    var dateH = 20; 
    var docsH = 20;  
    var docsR = 0;      
    var dateR = "";
    var docsW = 180;
    var docsHLimit = 800;
    var docsX = 600;

    var first = true;

    d3.json("./letters_match.json", function(data) {
      var letters = data;
    
      _.each(letters,function(l){

        if (docsR > docsHLimit) {
          docsX = docsX + docsW;
          docsR = 0;
        }

        if (dateR != l.date) {
          dateR = l.date;

          if (!first) {
            docsR = docsR + dateH
          } else {
            first = false
          } 

          docs.append("text")
              .attr("x",docsX)
              .attr("y",docsR)
              .attr("text-anchor", "start")       
              .attr("class", "dateHeader")
              .attr("dy", "0.15em")
              .text(months[parseInt(dateR.split("-")[1]) - 1] + " " + dateR.split("-")[0]);
          
          docsR = docsR + dateH

        }

        docs.append("text")
            .attr("x",docsX + 5)
            .attr("y",docsR)
            .attr("class","letters")
            .attr("text-anchor", "start")       
            .style("font", "10px sans-serif")
            .attr("fill","#B3B8B2")
            .attr("dy", "0.15em")
            .attr("id",l.id)
            .text(l.text.slice(0,30) + " ...")
            .on("mouseover", function() {
              d3.select(this).style("cursor", "pointer");     
              div.transition()    
                 .duration(200)    
                 .style("opacity", .9);    
              div.html(l.id + "<br/>"  + l.text)  
                 .style("left", (d3.event.pageX + 10) + "px")   
                 .style("top",  (d3.event.pageY - 28) + "px");  
            })
            .on("mouseout", function() { 
              d3.select(this).style("cursor", "default")  
              div.transition()    
                 .duration(500)    
                 .style("opacity", 0); 
            });      

        docsR = docsR + docsH

      })  
    });

    function wrap(text, width, textRef) { 
      text.each(function() {
        var text = d3.select(this);
        var words = text.text().split(/[\s,']+/).reverse(),
            word,
            line = [],
            lineNumber = 0,
            y = text.attr("y"),
            dy = parseFloat(text.attr("dy")),
            tspanRef = text.text(null).append("tspan").attr("class","ref");
            xRef = 0
        while (word = words.pop()) {
          line.push(word);
          cleanedword = removeDiacritics(word.toLowerCase())
          tspanRef.text(line.join(" "));
          if (textRef[cleanedword] != null && textRef[cleanedword][0] > 0) {
            text.append("tspan")
              .attr("x", xRef)
              .attr("y", y)
              .attr("dy", lineNumber * 12)
              .attr("dx", txtX)
              .text(word)
              .attr("fill","#B23C2C")
              .attr("id",textRef[cleanedword][1])
              .attr("target",textRef[cleanedword][2])
              .on("click", function(){
                var id = d3.select(this).attr("id")
                var target = d3.select(this).attr("target").split(",")
                var xs = parseInt(d3.select(this).attr("x")) + d3.select(this).node().getComputedTextLength() + txtX;
                var ys = parseInt(d3.select(this).attr("y")) + parseInt(d3.select(this).attr("dy") - 2);
                _.each(target, function(t){

                  var linkId = id + "-" + t;

                  d3.select("#" + t).attr("fill","#B23C2C");

                  if (!d3.select("#" + linkId).empty()) {
                    d3.select("#" + linkId).remove()
                    d3.select("#" + t).attr("fill","#B3B8B2");
                    return;                    
                  }

                  var xt = parseInt(d3.select("#" + t).attr("x"));
                  var yt = parseInt(d3.select("#" + t).attr("y"));
                  var pathData = lineGenerator([[xs,ys],[xt,yt]]);

                  txt.append("path")
                     .attr("class", "link")
                     .attr("id",linkId)
                     .attr("d", function(d) {
                        return "M" + xs + "," + ys
                             + "C" + (xt + 5) + "," + ys
                             + " " + (xt + 5) + "," + yt
                             + " " + xt + "," + yt;                        
                    });
                  
                })
              })
              .on("mouseover", function(){
                d3.select(this).style("cursor", "pointer"); 
              })
              .on("mouseout", function(){
                d3.select(this).style("cursor", "default"); 
              });
          } else {
            text.append("tspan").attr("x", xRef).attr("y", y).attr("dy", lineNumber * 12).attr("dx", txtX).attr("fill","#B3B8B2").text(word + " ");
          }          
          if (xRef == 0) {
            xRef = tspanRef.node().getComputedTextLength() + 2
          } else {
            xRef = tspanRef.node().getComputedTextLength()
          }
          if (tspanRef.node().getComputedTextLength() > width) {
            xRef = 0;
            line.pop();
            line = [];
            lineNumber = lineNumber + 1;
          }
        }
        text.select(".ref").remove()
      });
    }
    


  </script>  
 
</html>